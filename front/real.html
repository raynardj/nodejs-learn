<!DOCTYPE html>

<head>
    <!-- CSS only -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous">
    </script>
    <style>
        body,.form-control
        {
            font-size: 25px;
        }
    </style>
</head>

<body>
    <div class="row">
        <div class="col-sm-1"></div>
        <div class="col-sm-10">


            <h2 class='mt-5'>
                ä¸Šæµ·ä¹°ğŸ§¤äºŒæ‰‹æˆ¿ etc
            </h2>

            <div class='mt-5'>
                <ul class="list-group">
                    <li class="list-group-item">
                        <label for="price">æ€»ä»·(ä¸‡)</label>
                        <input name='price' id="price" type="text" class='form-control'>
                    </li>
                    <li class="list-group-item">
                        <label for="price_last">å–æ–¹ä¹°å…¥ä»·</label>
                        <input name='price_last' id="price_last" value=0 
                        type="text" placeholder=0 class='form-control'>
                    </li>
                    <li class="list-group-item">
                        <label for="markprice">åšå·®ä»·(ä¸‡) å¯ä»¥è´Ÿæ•°</label>
                        <input name='markprice' id="markprice" value=0 
                        type="text" placeholder=0 class='form-control'>
                    </li>
                    
                    <li class="list-group-item">
                        <label for="price2">åšä»·(ä¸‡) åˆåŒä»·</label>
                        <input name='price2' id="price2" value=0 
                        type="text" placeholder=0 class='form-control' readonly>
                    </li>
                    <li class="list-group-item">
                        <label for="realtype">ä½å®…ç±»å‹</label>
                        <select name="realtype" id="realtype" class='form-control'>
                            <option value="extraordi">éæ™®é€šä½å®…</option>
                            <option value="oridi">æ™®é€šä½å®…</option>
                        </select>
                    </li>
                    
                    <li class="list-group-item">
                        <label for="years">å¹´ä»½</label>
                        <select name="years" id="years" class='form-control'>
                            <option value="0">2 å¹´ä¸åˆ°</option>
                            <option value="1">2-5 å¹´</option>
                            <option value="2">5 å¹´ä»¥ä¸Š</option>
                        </select>
                    </li>
                    <li class="list-group-item">
                        <label for="only">äº§æƒäººå®¶åº­å”¯ä¸€</label>
                        <select name="only" id="only" class='form-control'>
                            <option value=0>ä¸å”¯ä¸€</option>
                            <option value=1>å”¯ä¸€</option>
                        </select>
                    </li>
                    <li class="list-group-item">
                        <h5>è´·æ¬¾</h5>
                    </li>
                    <li class="list-group-item">
                        <label for="downpay">é¦–ä»˜</label>
                        <input name='downpay' id='downpay' type="text" class='form-control'>
                    </li>
                    <li class="list-group-item">
                        <label for="gov_loan">å…¬ç§¯é‡‘è´·æ¬¾ (ä¸‡)</label>
                        <input name='gov_loan' type="text" placeholder="100" default=100 class='form-control'>
                    </li>
                    <li class="list-group-item">
                        <h5>
                            ç¨è´¹
                        </h5>
                    </li>
                    <li class="list-group-item">
                        <label for="vat">å¢å€¼ç¨</label>
                        <input type="text" name="vat" id="vat" class="form-control">
                    </li>
                    <li class="list-group-item">
                        <label for="pit">ä¸ªç¨</label>
                        <input type="text" name="pit" id="pit" class="form-control">
                    </li>
                    <li class="list-group-item">
                        <label for="deedtax">å¥‘ç¨</label>
                        <input type="text" name="deedtax" id="deedtax" class="form-control">
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="col-sm-1"></div>
    </div>
</body>
<script>
    $(document).ready(function(){

        const update_downpay = (price)=>{
            var downpay = price*0.35
            $("#downpay").val(downpay)
        }
        const calc_deedtax = (data)=>{
            const {price2} = data
            var deedtax = price2*0.01
            $("#deedtax").val(deedtax)
            return deedtax
        }

        const update_data = ()=>{
            var price = parseInt($("#price").val())
            var markprice = parseInt($("#markprice").val())
            var isordi = $("#realtype")[0].selectedIndex
            var years = $('#years')[0].selectedIndex
            var price_last = $('#price_last').val()
            
            console.log({price,markprice,isordi})
            $("#price2").val(price+markprice)
            price2 = price+markprice
            return {price2,isordi,markprice,years,price_last}
        }

        const va_t = (va)=>{
            return (va/1.05)*0.056
        }

        const calc_vat = (data)=>{
            const {isordi,years,price2,price_last} = data
            if(isordi==1){ // ordinary
                if(years==0){// less than 2 years
                    return va_t(price2)
                }
                else{
                    return 0
                }
            }else{// not ordinary
                if(years==0){// less than 2 years
                    return va_t(price2)
                }else{ // mroe than 2 years
                    return va_t(price2-price_last)
                }
            }
        }

        const calc_PIT = (data)=>{
            // personal income tax
            const {only,price2,price_last,isordi} = data
            if (only ==1){
                return 0
            }else{
                const pit_rate = (isordi==1)?0.01:0.02;
                var t1 = (price2)*pit_rate;
                var t2 = (price2-price_last)*0.2
                return t1>t2?t2:t1
            }
        }

        const update_all = ()=>{
            const data = update_data()
            
            update_downpay(data.price2)
            const deedtax = calc_deedtax(data)
            const vat = calc_vat(data)
            const pit = calc_PIT(data,vat)

            $("#vat").val(vat)
            $("#pit").val(pit)
            console.log({vat,pit,deedtax})
        }
        const change_assign = (id_)=>{
            $(`#${id_}`).change(update_all)
        }
        change_assign("markprice");
        change_assign("price");
        change_assign("price_last")
        change_assign("isordi")
        change_assign("realtype")
        change_assign("years")
        change_assign("only")
    })
</script>